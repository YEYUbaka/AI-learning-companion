# 🔍 模型切换问题诊断

## 问题现象
前端正确发送了provider参数（deepseek、moonshot），但切换后还是使用同一个AI回答

## 🔍 诊断步骤

### 步骤1：检查后端日志

查看后端PowerShell窗口，应该看到：

**选择deepseek时**：
```
[DEBUG] 收到请求 - prompt: ..., provider: deepseek
[DEBUG] 使用模型提供商: deepseek
[DEBUG] 最终使用的provider: deepseek
[DEBUG] 调用模型 - Provider: DeepSeek, Base URL: ..., Model: ...
```

**选择moonshot时**：
```
[DEBUG] 收到请求 - prompt: ..., provider: moonshot
[DEBUG] 使用模型提供商: moonshot
[DEBUG] 最终使用的provider: moonshot
[DEBUG] 调用模型 - Provider: Moonshot, Base URL: https://api.moonshot.cn/v1, Model: ...
```

### 步骤2：检查API密钥配置

如果看到错误：
```
[ERROR] 错误：未配置 MOONSHOT_API_KEY，请在 .env 文件中设置
```

说明API密钥未配置。

### 步骤3：检查.env文件

确保`.env`文件中配置了对应模型的API密钥：

```ini
# Moonshot配置
MOONSHOT_API_KEY=你的真实密钥（不是your_moonshot_api_key_here）
MOONSHOT_API_BASE_URL=https://api.moonshot.cn/v1
MOONSHOT_MODEL=kimi-k2-0905-preview
```

## 🛠️ 可能的问题和解决方案

### 问题1：API密钥未配置或错误

**症状**：
- 后端日志显示 `[ERROR] 错误：未配置 XXX_API_KEY`
- 或者API调用失败

**解决**：
1. 检查`.env`文件中的API密钥
2. 确保密钥格式正确（没有引号，没有多余空格）
3. 确保密钥是有效的

### 问题2：后端没有正确接收provider参数

**症状**：
- 后端日志显示 `provider: None` 或没有显示provider

**解决**：
- 检查后端代码是否已更新
- 重启后端服务

### 问题3：API调用失败，回退到默认模型

**症状**：
- 后端日志显示使用了正确的provider
- 但API调用失败
- 可能回退到DeepSeek

**解决**：
- 检查API密钥是否正确
- 检查API服务是否正常
- 查看后端日志中的详细错误信息

## 📝 请提供以下信息

1. **后端日志**：
   - 选择moonshot时，后端窗口显示什么？
   - 是否有 `[DEBUG] 使用模型提供商: moonshot`？
   - 是否有错误信息？

2. **.env文件配置**：
   - `MOONSHOT_API_KEY` 是否已配置？
   - 密钥格式是否正确？

3. **前端控制台**：
   - 是否有错误信息？
   - Network标签中请求是否成功？

---

**请查看后端PowerShell窗口的日志，告诉我看到了什么！** 🔍

