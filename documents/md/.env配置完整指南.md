# 📝 .env 配置文件完整指南

## 📍 文件位置

`.env` 文件应该放在 `backend` 目录下：

```
F:\Cursor projects\Web\backend\.env
```

## 🔧 如何创建/编辑 .env 文件

### 方法1：使用文本编辑器
1. 打开 `backend` 文件夹
2. 如果已有 `.env` 文件，直接打开编辑
3. 如果没有，创建一个新文件，命名为 `.env`（注意前面有点）

### 方法2：使用命令行
```powershell
cd "F:\Cursor projects\Web\backend"
notepad .env
```

## 📋 完整配置模板

复制以下内容到 `.env` 文件中，然后填入你的API密钥：

```ini
# ============================================
# AI模型提供商配置
# ============================================
# 支持的提供商: deepseek, wenxin, xinghuo, chatglm, moonshot
# 这个值决定默认使用的模型（可以通过前端UI切换）
AI_PROVIDER=deepseek

# ============================================
# DeepSeek API 配置
# ============================================
# 获取API Key: https://platform.deepseek.com/
DEEPSEEK_API_KEY=sk-your_deepseek_api_key_here
DEEPSEEK_API_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# 兼容旧配置（如果设置了AI_API_KEY，DeepSeek会优先使用它）
AI_API_KEY=sk-your_deepseek_api_key_here
AI_API_BASE_URL=https://api.deepseek.com/v1
AI_MODEL=deepseek-chat

# ============================================
# 文心一言 API 配置
# ============================================
# 获取API Key: https://cloud.baidu.com/product/wenxinworkshop
WENXIN_API_KEY=your_wenxin_api_key_here
WENXIN_API_BASE_URL=https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat
WENXIN_MODEL=ernie-bot-turbo

# ============================================
# 星火 API 配置
# ============================================
# 获取API Key: https://xinghuo.xfyun.cn/
XINGHUO_API_KEY=your_xinghuo_api_key_here
XINGHUO_API_BASE_URL=https://spark-api.xf-yun.com/v1
XINGHUO_MODEL=general

# ============================================
# ChatGLM API 配置
# ============================================
# 获取API Key: https://open.bigmodel.cn/
CHATGLM_API_KEY=your_chatglm_api_key_here
CHATGLM_API_BASE_URL=https://open.bigmodel.cn/api/paas/v4
CHATGLM_MODEL=glm-4

# ============================================
# Moonshot API 配置
# ============================================
# 获取API Key: https://platform.moonshot.cn/
MOONSHOT_API_KEY=your_moonshot_api_key_here
MOONSHOT_API_BASE_URL=https://api.moonshot.cn/v1
MOONSHOT_MODEL=moonshot-v1-8k
```

## 🔑 如何获取API密钥

### 1. DeepSeek
- 访问：https://platform.deepseek.com/
- 注册/登录账号
- 在控制台创建API Key
- 格式：`sk-xxxxxxxxxxxxx`

### 2. 文心一言
- 访问：https://cloud.baidu.com/product/wenxinworkshop
- 注册百度智能云账号
- 开通文心一言服务
- 获取API Key和Secret Key

### 3. 星火
- 访问：https://xinghuo.xfyun.cn/
- 注册讯飞账号
- 开通星火大模型服务
- 获取API Key

### 4. ChatGLM
- 访问：https://open.bigmodel.cn/
- 注册智谱AI账号
- 开通ChatGLM服务
- 获取API Key

### 5. Moonshot
- 访问：https://platform.moonshot.cn/
- 注册账号
- 开通服务
- 获取API Key

## 📝 配置示例

假设你已经准备好了所有API密钥，`.env` 文件应该这样配置：

```ini
# 默认使用DeepSeek
AI_PROVIDER=deepseek

# DeepSeek配置
DEEPSEEK_API_KEY=sk-1234567890abcdefghijklmnopqrstuvwxyz
DEEPSEEK_API_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# 文心一言配置
WENXIN_API_KEY=abc123def456ghi789
WENXIN_API_BASE_URL=https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat
WENXIN_MODEL=ernie-bot-turbo

# 星火配置
XINGHUO_API_KEY=xyz789abc123def456
XINGHUO_API_BASE_URL=https://spark-api.xf-yun.com/v1
XINGHUO_MODEL=general

# ChatGLM配置
CHATGLM_API_KEY=glm-1234567890abcdef
CHATGLM_API_BASE_URL=https://open.bigmodel.cn/api/paas/v4
CHATGLM_MODEL=glm-4

# Moonshot配置
MOONSHOT_API_KEY=moonshot-1234567890abcdef
MOONSHOT_API_BASE_URL=https://api.moonshot.cn/v1
MOONSHOT_MODEL=moonshot-v1-8k
```

## 🚀 如何使用

### 方法1：前端UI切换（推荐）✨

1. **配置好所有API密钥**后，重启后端服务
2. 访问前端页面：http://localhost:5173/ai
3. 在页面顶部的"选择模型"下拉框中选择模型
4. 直接提问，系统会使用你选择的模型

### 方法2：修改默认模型

1. 修改 `.env` 文件中的 `AI_PROVIDER`：
   ```ini
   AI_PROVIDER=wenxin  # 改为你想默认使用的模型
   ```
2. **重启后端服务**
3. 访问前端页面，默认会使用新配置的模型

## ⚠️ 重要提示

1. **API密钥格式**：
   - 不要包含引号
   - 不要有多余的空格
   - 直接粘贴密钥值

2. **配置后必须重启后端**：
   - 修改 `.env` 文件后
   - 必须重启后端服务才能生效
   - 前端UI切换不需要重启

3. **API密钥安全**：
   - 不要将 `.env` 文件提交到Git
   - 不要分享你的API密钥
   - `.env` 文件已经在 `.gitignore` 中

4. **测试配置**：
   - 配置完成后，访问：http://127.0.0.1:8000/api/v1/ai/providers
   - 查看返回的模型列表和当前配置

## 🧪 测试步骤

1. **配置API密钥**：
   ```ini
   # 至少配置一个模型的API密钥
   DEEPSEEK_API_KEY=你的密钥
   ```

2. **重启后端服务**

3. **测试前端切换**：
   - 访问 http://localhost:5173/ai
   - 选择不同的模型
   - 发送问题测试

4. **检查错误**：
   - 如果某个模型无法使用，检查：
     - API密钥是否正确
     - 是否配置了对应的密钥
     - 后端日志中的错误信息

## 📞 常见问题

### Q: 如何知道API密钥是否正确？
A: 发送一个问题，如果返回错误提示"未配置XXX_API_KEY"，说明密钥未配置或配置错误。

### Q: 可以只配置一个模型吗？
A: 可以！只需要配置你想使用的模型的API密钥即可。

### Q: 前端UI中看不到某个模型？
A: 检查后端是否支持该模型，访问 `/api/v1/ai/providers` 查看支持的模型列表。

### Q: 切换模型后没有效果？
A: 
- 前端UI切换：检查是否选择了正确的模型
- 配置文件切换：确保重启了后端服务

---

**现在就去配置你的API密钥吧！** 🔑

