# 🔍 模型选择器问题排查

## 问题现象
前端模型切换下拉框没有选项

## ✅ 已修复的问题

### 1. 添加了加载状态
- 如果providers数组为空，显示"加载中..."
- 添加了更好的错误处理

### 2. 添加了调试日志
- 在控制台输出加载的providers数据
- 方便排查问题

### 3. 添加了默认值fallback
- 如果API请求失败，使用默认的模型列表

## 🔍 排查步骤

### 步骤1：检查浏览器控制台

1. 打开前端页面：http://localhost:5173/ai
2. 按 `F12` 打开开发者工具
3. 查看 **Console** 标签
4. 应该能看到：`Loaded providers: {providers: [...], current: "deepseek"}`

**如果看到错误**：
- `Failed to load providers: ...` - 说明API请求失败
- `CORS error` - 说明跨域问题
- `Network error` - 说明后端服务未运行

### 步骤2：检查Network请求

1. 在开发者工具中，点击 **Network** 标签
2. 刷新页面（F5）
3. 查找 `providers` 请求
4. 检查：
   - 状态码是否为 200
   - 响应内容是否正确

**应该看到**：
```json
{
  "providers": ["deepseek", "wenxin", "xinghuo", "chatglm", "moonshot"],
  "current": "deepseek"
}
```

### 步骤3：检查后端服务

```powershell
# 测试后端接口
Invoke-WebRequest -Uri "http://127.0.0.1:8000/api/v1/ai/providers"
```

应该返回JSON数据。

### 步骤4：检查前端环境变量

检查前端是否正确配置了API地址：

1. 查看浏览器控制台
2. 检查是否有 `VITE_API_BASE` 相关的错误
3. 默认使用：`http://127.0.0.1:8000`

## 🛠️ 可能的解决方案

### 方案1：刷新页面
- 按 `Ctrl+F5` 硬刷新
- 清除浏览器缓存

### 方案2：检查后端CORS配置
确保后端允许前端域名访问：
```python
# backend/main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 应该允许所有来源
    ...
)
```

### 方案3：检查前端API地址
如果前端和后端不在同一域名，需要配置：
```javascript
// frontend/.env 或 vite.config.js
VITE_API_BASE=http://127.0.0.1:8000
```

### 方案4：手动测试API
在浏览器中直接访问：
```
http://127.0.0.1:8000/api/v1/ai/providers
```

应该能看到JSON响应。

## 🎯 快速测试

1. **打开浏览器控制台**（F12）
2. **刷新页面**（F5）
3. **查看Console输出**：
   - 应该看到：`Loaded providers: {...}`
   - 如果看到错误，告诉我错误信息

4. **检查下拉框**：
   - 如果显示"加载中..."，说明正在加载
   - 如果显示选项，说明正常
   - 如果什么都不显示，可能是CSS问题

## 📝 已添加的改进

1. ✅ 添加了加载状态显示
2. ✅ 添加了控制台日志
3. ✅ 添加了错误处理
4. ✅ 添加了默认值fallback
5. ✅ 改进了错误提示

---

**请刷新前端页面，然后告诉我：**
1. 浏览器控制台有什么输出？
2. 下拉框显示什么？（选项/加载中/空白）
3. Network标签中providers请求的状态是什么？

