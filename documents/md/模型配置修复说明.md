# 🔧 模型配置修复说明

## ✅ 模型切换功能已正常工作！

从日志可以看到，模型切换功能已经成功实现：
- ✅ **Moonshot** - 成功调用并返回内容
- ✅ **ChatGLM** - 成功调用并返回内容
- ❌ **文心一言** - 需要修复模型名称
- ❌ **星火** - 需要修复模型名称

## 🔍 问题分析

### 文心一言错误
```
[ERROR] API调用失败 - Provider: 文心一言, Error: Error code: 401 - {'error': {'code': 'invalid_model', 'message': 'The model does not exist or you do not have access to it.'}}
```

**原因**：当前配置的模型名称 `ernie-x1.1` 不存在或没有访问权限。

**解决方案**：修改 `.env` 文件中的 `WENXIN_MODEL`，改为以下之一：
- `ernie-bot-turbo` （推荐，通用版本）
- `ernie-3.5-8k` （如果支持）
- `ernie-bot` （如果支持）

### 星火错误
```
[ERROR] API调用失败 - Provider: 星火, Error: Error code: 400 - {'error': {'message': 'invalid param model:general'}}
```

**原因**：当前配置的模型名称 `general` 不是有效的模型名称。

**解决方案**：修改 `.env` 文件中的 `XINGHUO_MODEL`，改为以下之一：
- `spark-3.5` （推荐）
- `spark-4.0` （如果支持）
- `spark-lite` （如果支持）

## 📝 修复步骤

### 1. 打开 `.env` 文件

在 `backend` 目录下找到 `.env` 文件。

### 2. 修改模型名称

找到以下两行并修改：

```ini
# 修改前
WENXIN_MODEL=ernie-x1.1
XINGHUO_MODEL=general

# 修改后
WENXIN_MODEL=ernie-bot-turbo
XINGHUO_MODEL=spark-3.5
```

### 3. 重启后端服务

修改后必须重启后端服务：

```powershell
# 在后端PowerShell窗口按 Ctrl+C 停止服务
# 然后重新启动
cd backend
.\venv\Scripts\activate
uvicorn main:app --reload --port 8000
```

### 4. 测试

重启后，在前端切换模型并测试：
- 选择 **文心一言**，发送问题
- 选择 **星火**，发送问题
- 查看后端日志，应该看到成功调用

## 🎯 如何确定正确的模型名称

### 方法1：查看API文档
- 文心一言：https://cloud.baidu.com/doc/WENXINWORKSHOP/s/Ilkkrb0i5
- 星火：https://www.xfyun.cn/doc/spark/API.html

### 方法2：查看你的API密钥对应的模型列表
登录对应的平台，查看你的API密钥可以访问哪些模型。

### 方法3：尝试常见模型名称
- 文心一言：`ernie-bot-turbo`, `ernie-3.5-8k`, `ernie-bot`
- 星火：`spark-3.5`, `spark-4.0`, `spark-lite`

## ✅ 当前工作正常的模型

- ✅ **Moonshot** - 模型：`kimi-k2-0905-preview`
- ✅ **ChatGLM** - 模型：`glm-4.6`
- ✅ **DeepSeek** - 模型：`deepseek-ai/DeepSeek-V3`

这些模型已经可以正常切换使用了！

---

**修改完成后，重启后端并测试，应该就能正常使用所有模型了！** 🎉

