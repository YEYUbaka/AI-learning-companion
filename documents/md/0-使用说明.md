# 智学伴项目 - 部署脚本使用说明

## 📋 脚本列表

### 1. `1-完整部署检查.bat` - 完整环境检查
**功能：** 检查所有部署环境，包括：
- Python 环境
- Node.js 环境
- 后端虚拟环境和依赖
- 前端 node_modules 和依赖
- 端口占用情况
- 环境变量配置

**使用场景：** 首次部署、环境迁移、问题排查

**运行方式：** 双击运行或在命令行执行

---

### 2. `2-启动后端服务.bat` - 启动后端服务
**功能：** 
- 检查并激活虚拟环境
- 检查关键依赖（FastAPI、Uvicorn、python-multipart）
- 检查端口占用
- 启动 FastAPI 后端服务

**服务地址：**
- API: http://127.0.0.1:8000
- 文档: http://127.0.0.1:8000/docs

**使用场景：** 单独启动后端服务

---

### 3. `3-启动前端服务.bat` - 启动前端服务
**功能：**
- 检查 package.json
- 检查 node_modules（不存在则自动安装）
- 启动 Vite 开发服务器

**服务地址：** http://localhost:5173/ （或自动分配的端口）

**使用场景：** 单独启动前端服务

---

### 4. `4-检查并修复环境.bat` - 自动修复环境
**功能：**
- 创建后端虚拟环境（如果不存在）
- 安装后端依赖
- 安装前端依赖
- 修复常见环境问题

**使用场景：** 
- 首次部署
- 环境损坏需要重建
- 依赖缺失需要重新安装

---

### 5. `5-一键启动前后端.bat` - 一键启动所有服务
**功能：**
- 自动启动后端服务（新窗口）
- 自动启动前端服务（新窗口）
- 显示服务地址和提示信息

**使用场景：** 快速启动整个项目

---

## 🚀 快速开始

### 首次部署

1. **检查环境**
   ```
   运行: 1-完整部署检查.bat
   ```

2. **修复环境（如果需要）**
   ```
   运行: 4-检查并修复环境.bat
   ```

3. **启动服务**
   ```
   运行: 5-一键启动前后端.bat
   ```

### 日常启动

**方式1：一键启动（推荐）**
```
运行: 5-一键启动前后端.bat
```

**方式2：分别启动**
```
运行: 2-启动后端服务.bat
运行: 3-启动前端服务.bat（新窗口）
```

---

## 📝 详细步骤

### 步骤1：环境检查

运行 `1-完整部署检查.bat`，查看检查结果：

- ✅ **所有检查通过**：可以直接启动服务
- ⚠️ **有警告**：建议修复后启动
- ❌ **有错误**：必须修复后才能启动

### 步骤2：修复环境（如果需要）

如果检查发现错误或警告，运行 `4-检查并修复环境.bat`：

- 自动创建虚拟环境
- 自动安装所有依赖
- 修复常见问题

### 步骤3：启动服务

**推荐方式：一键启动**
```
运行: 5-一键启动前后端.bat
```

这会自动打开两个窗口：
- 后端服务窗口（端口 8000）
- 前端服务窗口（端口 5173）

**手动启动：**
```
窗口1: 运行 2-启动后端服务.bat
窗口2: 运行 3-启动前端服务.bat
```

---

## ⚠️ 常见问题

### 问题1：虚拟环境不存在

**错误信息：** `❌ 虚拟环境不存在`

**解决方案：**
```
运行: 4-检查并修复环境.bat
```

### 问题2：依赖未安装

**错误信息：** `❌ FastAPI 未安装` 或 `❌ React 未安装`

**解决方案：**
```
后端: 运行 4-检查并修复环境.bat
前端: 进入前端目录运行 npm install
```

### 问题3：端口被占用

**错误信息：** `⚠️ 端口 8000 已被占用`

**解决方案：**
- 脚本会自动提示是否终止占用进程
- 或手动终止占用端口的进程
- 或修改脚本使用其他端口

### 问题4：Python 版本过低

**错误信息：** `⚠️ Python 版本过低`

**解决方案：**
- 安装 Python 3.9 或更高版本
- 重新创建虚拟环境

### 问题5：Node.js 未安装

**错误信息：** `❌ Node.js 未安装`

**解决方案：**
- 下载并安装 Node.js: https://nodejs.org/
- 确保 Node.js 在 PATH 中

---

## 🔧 高级用法

### 修改端口

**后端端口：**
编辑 `2-启动后端服务.bat`，修改：
```batch
uvicorn main:app --reload --port 8000
```
改为：
```batch
uvicorn main:app --reload --port 8001
```

**前端端口：**
编辑 `frontend/vite.config.js`，添加：
```javascript
server: {
  port: 5174
}
```

### 自定义启动参数

**后端：**
编辑 `2-启动后端服务.bat`，修改 uvicorn 命令：
```batch
uvicorn main:app --reload --port 8000 --host 0.0.0.0 --workers 4
```

**前端：**
编辑 `3-启动前端服务.bat`，修改 npm 命令：
```batch
npm run dev -- --port 5174
```

---

## 📞 测试服务

### 测试后端

1. 访问 API 文档：http://127.0.0.1:8000/docs
2. 测试健康检查：http://127.0.0.1:8000/health

### 测试前端

1. 访问前端页面：http://localhost:5173/
2. 测试登录功能
3. 测试文件上传
4. 测试 AI 问答
5. 测试 PDF 导出

---

## ✅ 启动成功标志

### 后端成功标志：
```
INFO:     Will watch for changes in these directories: ['C:\\Web\\Zhixueban\\backend']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxx] using WatchFiles
INFO:     Started server process [xxxx]
INFO:     Waiting for application startup.
✅ 数据库表创建成功
INFO:     Application startup complete.
```

### 前端成功标志：
```
> zhixueban-frontend@1.0.0 dev
> vite

  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://192.168.x.x:5173/
```

---

## 📚 相关文档

- `服务器-启动指南.md` - 服务器部署详细指南
- `完整启动指南.md` - 完整启动说明
- `服务器-修复虚拟环境.bat` - 修复虚拟环境脚本

---

## 💡 提示

1. **首次部署**：建议先运行 `1-完整部署检查.bat` 检查环境
2. **快速启动**：日常使用推荐 `5-一键启动前后端.bat`
3. **问题排查**：遇到问题先运行 `1-完整部署检查.bat` 查看问题
4. **环境修复**：环境损坏时运行 `4-检查并修复环境.bat`

---

## 🎯 脚本执行顺序

### 首次部署：
```
1-完整部署检查.bat
    ↓
4-检查并修复环境.bat（如果有错误）
    ↓
5-一键启动前后端.bat
```

### 日常启动：
```
5-一键启动前后端.bat
```

### 问题排查：
```
1-完整部署检查.bat
    ↓
根据检查结果修复问题
    ↓
4-检查并修复环境.bat（如果需要）
```

