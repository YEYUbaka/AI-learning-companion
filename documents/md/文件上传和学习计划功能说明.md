# 📚 文件上传 + AI学习计划生成模块

## ✅ 功能已完成

已成功创建文件上传和AI学习计划生成模块，包含完整的前后端代码。

---

## 📁 文件结构

### 后端文件

```
backend/
├── models/
│   └── study_plans.py          # 学习计划数据模型
├── routers/
│   ├── files.py                # 文件上传路由
│   └── plan.py                 # 学习计划路由
├── utils/
│   ├── file_parser.py          # 文件解析工具（PDF/TXT/MD）
│   └── plan_generator.py       # AI计划生成器
├── main.py                     # 已更新，引入新路由
└── requirements.txt            # 已更新，添加 pymupdf 和 chardet
```

### 前端文件

```
frontend/src/
├── pages/
│   ├── UploadFile.jsx          # 文件上传页面
│   └── StudyPlan.jsx           # 学习计划展示页面
├── api/
│   └── apiClient.js            # 已更新，添加新API方法
└── App.jsx                     # 已更新，添加新路由
```

---

## 🚀 安装依赖

### 后端依赖

在 `backend` 目录下运行：

```powershell
cd backend
.\venv\Scripts\activate
pip install -r requirements.txt
```

新增依赖：
- `pymupdf>=1.23.0` - PDF文件解析
- `chardet>=5.0.0` - 文本文件编码检测

### 前端依赖

前端已使用 `axios` 和 `react-router-dom`，如果未安装：

```powershell
cd frontend
npm install axios react-router-dom
```

---

## 📋 API接口说明

### 文件上传接口

**POST** `/api/v1/files/upload`

- **参数**: `file` (multipart/form-data)
- **支持格式**: PDF, TXT, MD, Markdown
- **最大大小**: 10MB
- **返回**: 文件信息和解析结果

### 学习计划生成接口

**POST** `/api/v1/ai/plan/generate`

请求体：
```json
{
  "user_id": 1,
  "goals": "三天掌握Python基础",
  "file_text": "教材内容...",
  "file_name": "python.pdf",
  "provider": "deepseek"
}
```

返回：
```json
{
  "id": 1,
  "user_id": 1,
  "goal": "三天掌握Python基础",
  "plan": [
    {
      "day": 1,
      "topic": "基础语法",
      "tasks": ["学习变量", "练习if语句"]
    }
  ],
  "file_name": "python.pdf",
  "created_at": "2024-01-01T00:00:00"
}
```

### 获取用户计划列表

**GET** `/api/v1/ai/plan/list/{user_id}`

### 获取指定计划

**GET** `/api/v1/ai/plan/{plan_id}`

### 删除计划

**DELETE** `/api/v1/ai/plan/{plan_id}`

---

## 🎯 使用流程

### 1. 启动后端

```powershell
cd backend
.\venv\Scripts\activate
uvicorn main:app --reload --port 8000
```

### 2. 启动前端

```powershell
cd frontend
npm run dev
```

### 3. 访问页面

1. **上传文件页面**: http://localhost:5173/upload-file
2. **学习计划页面**: http://localhost:5173/study-plan

### 4. 操作步骤

1. 访问 `/upload-file` 页面
2. 选择文件（PDF/TXT/MD）
3. 点击"上传文件"
4. 输入学习目标（例如："三天掌握Python基础"）
5. 点击"生成学习计划"
6. 自动跳转到 `/study-plan` 查看生成的计划

---

## 🎨 功能特点

### 文件解析

- ✅ 支持 PDF 文件（使用 PyMuPDF）
- ✅ 支持 TXT 文件（自动检测编码）
- ✅ 支持 Markdown 文件
- ✅ 自动识别文件编码（GBK、UTF-8等）

### AI计划生成

- ✅ 使用配置的AI模型（DeepSeek等）
- ✅ 生成3~7天学习计划
- ✅ 结构化JSON输出
- ✅ 自动过滤Markdown符号

### 数据存储

- ✅ SQLite数据库存储
- ✅ 支持多用户
- ✅ 记录创建时间

### 前端界面

- ✅ 现代化UI设计（Tailwind CSS）
- ✅ 文件拖拽上传
- ✅ 实时状态反馈
- ✅ 响应式布局
- ✅ 学习计划卡片展示

---

## 🔧 配置说明

### AI模型配置

AI模型使用 `.env` 文件中的配置，默认使用 DeepSeek。可以在生成计划时指定 `provider` 参数使用其他模型。

### 文件存储

上传的文件保存在 `backend/uploads/` 目录下。

### 数据库

使用 SQLite 数据库 `zhixueban.db`，表结构会自动创建。

---

## 🧪 测试建议

1. **测试文件上传**
   - 上传PDF文件
   - 上传TXT文件
   - 上传MD文件
   - 测试大文件（接近10MB）
   - 测试不支持的文件类型

2. **测试计划生成**
   - 输入不同长度的学习目标
   - 测试有/无文件内容的情况
   - 测试不同AI模型

3. **测试前端交互**
   - 文件选择
   - 上传进度
   - 错误处理
   - 页面跳转

---

## ⚠️ 注意事项

1. **文件大小限制**: 最大10MB
2. **文件类型**: 仅支持 PDF、TXT、MD
3. **用户ID**: 当前使用默认值1，实际应使用登录用户的ID
4. **AI Token限制**: 文件文本会被截断到3000字符，避免超出token限制
5. **数据库**: 首次运行会自动创建表结构

---

## 🐛 常见问题

### 1. PDF解析失败

**问题**: `ModuleNotFoundError: No module named 'fitz'`

**解决**: 安装 PyMuPDF
```powershell
pip install pymupdf
```

### 2. 文件上传失败

**检查**:
- 文件大小是否超过10MB
- 文件类型是否支持
- `uploads/` 目录是否有写入权限

### 3. AI生成失败

**检查**:
- `.env` 文件中的AI配置是否正确
- API密钥是否有效
- 网络连接是否正常

---

## 📝 后续优化建议

1. **用户认证**: 集成真实的用户认证系统
2. **文件管理**: 添加文件列表和删除功能
3. **计划编辑**: 允许用户手动编辑学习计划
4. **进度跟踪**: 添加学习进度记录功能
5. **多文件支持**: 支持一次上传多个文件
6. **计划分享**: 支持分享学习计划给其他用户

---

**功能已全部完成，可以立即使用！** 🎉

