# 🔍 模型切换问题排查

## 问题现象
前端模型选择器有选项，但切换后还是使用DeepSeek回答

## ✅ 已添加的调试功能

### 前端调试
- 在发送请求时，控制台会输出：`发送请求，使用模型: xxx`
- 可以检查是否正确发送了provider参数

### 后端调试
- 后端会打印：`[DEBUG] 收到请求 - provider: xxx`
- 后端会打印：`[DEBUG] 使用模型提供商: xxx`
- 后端会打印：`[DEBUG] 最终使用的provider: xxx`
- 后端会打印：`[DEBUG] 调用模型 - Provider: xxx, Base URL: xxx, Model: xxx`

## 🔍 排查步骤

### 步骤1：检查前端发送的参数

1. 打开浏览器开发者工具（F12）
2. 切换到 **Console** 标签
3. 在前端选择不同的模型（比如"文心一言"）
4. 发送一个问题
5. 查看控制台输出，应该看到：
   ```
   发送请求，使用模型: wenxin 请求体: {prompt: "...", provider: "wenxin"}
   ```

### 步骤2：检查后端接收的参数

1. 查看后端PowerShell窗口
2. 应该看到类似输出：
   ```
   [DEBUG] 收到请求 - prompt: ..., provider: wenxin
   [DEBUG] 使用模型提供商: wenxin
   [DEBUG] 最终使用的provider: wenxin
   [DEBUG] 调用模型 - Provider: 文心一言, Base URL: ..., Model: ...
   ```

### 步骤3：检查API密钥配置

如果后端显示使用了正确的provider，但还是用DeepSeek回答，可能是：

1. **API密钥未配置**：
   - 检查 `.env` 文件中是否配置了对应模型的API密钥
   - 例如：选择"文心一言"时，需要配置 `WENXIN_API_KEY`

2. **API密钥错误**：
   - 检查API密钥是否正确
   - 检查API密钥是否有效

3. **API调用失败，回退到默认模型**：
   - 查看后端日志中的错误信息
   - 如果API调用失败，可能会回退到默认模型

## 🛠️ 可能的问题和解决方案

### 问题1：前端没有发送provider参数

**检查方法**：
- 查看浏览器控制台，应该看到 `发送请求，使用模型: xxx`

**解决方案**：
- 确保前端代码已更新
- 刷新页面（Ctrl+F5）

### 问题2：后端没有接收provider参数

**检查方法**：
- 查看后端日志，应该看到 `[DEBUG] 收到请求 - provider: xxx`

**解决方案**：
- 确保后端代码已更新
- 重启后端服务

### 问题3：API密钥未配置

**检查方法**：
- 查看后端日志，如果看到 `错误：未配置 XXX_API_KEY`，说明密钥未配置

**解决方案**：
- 在 `.env` 文件中添加对应模型的API密钥
- 重启后端服务

### 问题4：API密钥错误或无效

**检查方法**：
- 查看后端日志中的错误信息
- 可能显示API调用失败

**解决方案**：
- 检查API密钥是否正确
- 检查API密钥是否过期
- 检查API服务是否正常

## 🧪 测试步骤

1. **选择模型**：
   - 在前端选择"文心一言"（或其他模型）
   - 确保下拉框显示的是"文心一言"

2. **发送问题**：
   - 输入一个问题并发送
   - 例如："你是谁？"

3. **检查日志**：
   - **前端控制台**：应该看到 `发送请求，使用模型: wenxin`
   - **后端日志**：应该看到 `[DEBUG] 使用模型提供商: wenxin`

4. **检查回答**：
   - 如果后端日志显示使用了正确的模型，但回答还是来自DeepSeek
   - 可能是API密钥未配置或错误

## 📝 快速检查清单

- [ ] 前端控制台显示正确的模型名称
- [ ] 后端日志显示接收到了正确的provider参数
- [ ] 后端日志显示使用了正确的模型配置
- [ ] `.env` 文件中配置了对应模型的API密钥
- [ ] API密钥格式正确（没有引号，没有多余空格）

---

**请告诉我：**
1. 前端控制台显示什么？（特别是"发送请求，使用模型"这一行）
2. 后端日志显示什么？（特别是"[DEBUG] 使用模型提供商"这一行）
3. 是否配置了对应模型的API密钥？

