# 智学伴项目 - 完整启动指南

## 📋 启动前检查

### 1. 检查Python环境
```powershell
# 检查Python版本（应该是3.9+）
python --version

# 检查虚拟环境是否存在
cd "F:\Cursor projects\Web\backend"
if (Test-Path "venv") { Write-Host "✅ 虚拟环境存在" } else { Write-Host "❌ 虚拟环境不存在，需要创建" }
```

### 2. 检查Node.js环境
```powershell
# 检查Node.js版本
node --version
npm --version
```

---

## 🚀 后端启动步骤

### 步骤1：进入后端目录并激活虚拟环境
```powershell
cd "F:\Cursor projects\Web\backend"
.\venv\Scripts\activate
```

### 步骤2：检查依赖是否安装
```powershell
# 检查关键依赖
pip list | Select-String "fastapi|uvicorn|reportlab|sqlalchemy"
```

### 步骤3：启动后端服务
```powershell
# 确保在虚拟环境中（命令行前应该有 (venv) 标识）
uvicorn main:app --reload --port 8000
```

### 预期输出：

```
INFO:     Will watch for changes in these directories: ['F:\\Cursor projects\\Web\\backend']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxx] using WatchFiles
INFO:     Started server process [xxxx]
INFO:     Waiting for application startup.
✅ 数据库表创建成功
INFO:     Application startup complete.
```

---

## 🎨 前端启动步骤

### 步骤1：打开新的PowerShell窗口（保持后端运行）

### 步骤2：进入前端目录
```powershell
cd "F:\Cursor projects\Web\frontend"
```

### 步骤3：检查依赖是否安装

```powershell
# 检查node_modules是否存在
if (Test-Path "node_modules") { Write-Host "✅ node_modules存在" } else { Write-Host "❌ 需要运行 npm install" }
```

### 步骤4：启动前端服务

```powershell
npm run dev
```

### 预期输出：
```
> zhixueban-frontend@1.0.0 dev
> vite

  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://192.168.x.x:5173/
```

---

## 🔍 验证服务是否正常

### 1. 检查后端API
在浏览器中访问：
- http://127.0.0.1:8000/docs （Swagger文档）
- http://127.0.0.1:8000/health （健康检查）

### 2. 检查前端
在浏览器中访问：
- http://localhost:5173/ （或显示的端口）

---

## 🧪 测试PDF生成功能

### 1. 登录系统
- 访问前端页面
- 登录或注册账号

### 2. 进入Dashboard
- 点击导航栏的"Dashboard"或访问 http://localhost:5173/dashboard

### 3. 生成PDF报告
- 点击"📄 导出学习报告PDF"按钮
- 等待PDF下载完成

### 4. 检查PDF
- 打开下载的PDF文件
- 在Adobe Acrobat中查看字体属性
- 应该显示 **SimHei** 字体，而不是 Helvetica
- 中文应该正常显示，而不是方块字

---

## 📝 完整启动命令（一键复制）

### 后端启动（PowerShell窗口1）
```powershell
cd "F:\Cursor projects\Web\backend"
.\venv\Scripts\activate
uvicorn main:app --reload --port 8000
```

### 前端启动（PowerShell窗口2）
```powershell
cd "F:\Cursor projects\Web\frontend"
npm run dev
```

---

## ⚠️ 常见问题

### 问题1：后端启动失败
**错误：** `uvicorn: The term 'uvicorn' is not recognized`
**解决：** 确保已激活虚拟环境：`.\venv\Scripts\activate`

### 问题2：端口被占用
**错误：** `Address already in use`
**解决：** 
- 关闭占用端口的程序
- 或使用其他端口：`uvicorn main:app --reload --port 8001`

### 问题3：前端启动失败
**错误：** `Port 5173 is in use`
**解决：** Vite会自动使用其他端口（如5174），使用显示的端口即可

### 问题4：PDF还是方块字
**解决：** 
1. 检查后端日志，确认字体注册成功
2. 查看日志中的字体信息：`📝 标题样式字体: SimHei`
3. 如果还是方块字，请查看后端日志的详细输出

---

## 🔧 如果遇到问题

### 重新安装依赖

**后端：**
```powershell
cd "F:\Cursor projects\Web\backend"
.\venv\Scripts\activate
pip install -r requirements.txt
```

**前端：**
```powershell
cd "F:\Cursor projects\Web\frontend"
npm install
```

### 清理并重新启动

**后端：**
```powershell
# 停止服务（Ctrl+C）
# 清理Python缓存
Remove-Item -Recurse -Force __pycache__, *.pyc -ErrorAction SilentlyContinue
# 重新启动
uvicorn main:app --reload --port 8000
```

**前端：**
```powershell
# 停止服务（Ctrl+C）
# 清理缓存
Remove-Item -Recurse -Force node_modules\.vite -ErrorAction SilentlyContinue
# 重新启动
npm run dev
```

---

## ✅ 启动成功标志

### 后端成功标志：
- ✅ 看到 `✅ 数据库表创建成功`
- ✅ 看到 `INFO: Application startup complete.`
- ✅ 访问 http://127.0.0.1:8000/docs 能看到API文档

### 前端成功标志：
- ✅ 看到 `VITE v5.x.x ready`
- ✅ 显示本地访问地址（如 http://localhost:5173/）
- ✅ 浏览器能正常打开前端页面

---

## 📞 测试PDF功能

启动成功后，请测试：
1. 访问 http://localhost:5173/dashboard
2. 点击"📄 导出学习报告PDF"按钮
3. 打开下载的PDF文件
4. 检查字体属性（应该显示SimHei）
5. 检查中文显示（应该正常显示，不是方块字）

如果PDF还是方块字，请查看后端日志，应该能看到详细的字体注册和应用信息。

